
%h2 New Post

#drawarea

= form_for(@post, :html => {:id => :draw_form, :style => 'display:none'}) do |f|
  = f.hidden_field :pixels
  = f.submit 'Send'

:javascript
  var flashReady = false;
  var timeout;

  function drawAreaReady() {
    flashReady = true;
  }

  $(document).ready(function() {
    var checkReady = function() {
      if (flashReady)
        return onReady();
      timeout = setTimeout(checkReady, 100); 
    }
    timeout = setTimeout(checkReady, 100); 
  });

  function onReady() {
    var drawForm = $('#draw_form');
    var pixelsInput = $('#post_pixels');
    var drawArea = $('#drawarea')[0];
    drawArea.setImageData(pixelsInput.val());
    // only show the submit form when the flash component is ready
    drawForm.show().submit(function() {
      pixelsInput.val(drawarea.getImageData());
    });
  }

  var params = {
    allowScriptAccess: "sameDomain"
  };
  var flashvars = {
  };
  swfobject.embedSWF("/flash/PicconDrawArea.swf?#{Rails.root.join('public/flash/PicconDrawArea.swf').mtime.to_i}", "drawarea", "640", "512", "9.0.0", false, flashvars, params);
